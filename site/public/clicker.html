<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/clicker.css">
    <title>†Clicker†</title>
</head>

<body>
    <div class="corpo">
        <div class="content">

            <div class="container" id="clicker_pontos">
                <div class="container" id="pontos">
                    Pontos: <span id="b_pontos">0.00</span>
                </div>
                <div class="container" id="clicker" onclick="clicker()">
                    <img src="assets/Bonnie.webp" alt="">
                </div>
            </div>

            <div class="container" id="upgrades_settings">
                <div id="settings">
                    <ul>
                        <li>Tempo restante: <span id="timerJogo">...</span></li>
                        <li onclick="salvarSair()">Salvar e sair</li>
                    </ul>
                </div>
                <div class="lista_upgrades">
                    <h1>Upgrades</h1>
                    <div class="upgrades" id="botao_upgrd1" onclick="upgrd1()">
                        <!--Aumenta o valor do clique no contador de pontos-->
                        <h2>Power Chord Boost</h2>
                        <div class="custo_nivel">
                            <p>nvl. <span id="b_upgrd1">1</span></p>
                            <p>Custo: <span id="b_custoUpgrd1">50</span></p>
                        </div>
                        <div class="desc_upgrades" id="desc_upgrd1">
                            <p>Aumenta a potência dos cliques, transformando-os em poderosos acordes de guitarra.</p>
                            <p>+1 ponto por clique.</p>
                        </div>
                    </div>

                    <div class="upgrades" id="botao_upgrd2" onclick="upgrd2()">
                        <!--Aumenta o valor dos pontos por segundo - barato-->
                        <h2>Riff Generator</h2>
                        <div class="custo_nivel">
                            <p>nvl. <span id="b_upgrd2">0</span></p>
                            <p>Custo: <span id="b_custoUpgrd2">15</span></p>
                        </div>
                        <div class="desc_upgrades" id="desc_upgrd2">
                            <p>Desbloqueia um gerador de riffs automático que adiciona pontos constantemente ao seu
                                total.</p>
                            <p>+0.10 ponto por segundo.</p>
                        </div>
                    </div>

                    <div class="upgrades" id="botao_upgrd3" onclick="upgrd3()">
                        <!--Aumenta o valor de pontos por segundo - caro-->
                        <h2>Drum Solo Fury</h2>
                        <div class="custo_nivel">
                            <p>nvl. <span id="b_upgrd3">0</span></p>
                            <p>Custo: <span id="b_custoUpgrd3">150</span></p>
                        </div>
                        <div class="desc_upgrades" id="desc_upgrd3">
                            <p>Ative um frenesi de solos de bateria, multiplicando seus pontos por segundo.</p>
                            <p>+2 pontos por segundo.</p>
                        </div>
                    </div>

                    <div class="upgrades" id="botao_upgrd4" onclick="upgrd4()">
                        <!--Aumenta o valor por segundo - muito caro-->
                        <h2>Bassline Resonance</h2>
                        <div class="custo_nivel">
                            <p>nvl. <span id="b_upgrd4">0</span></p>
                            <p>Custo: <span id="b_custoUpgrd4">450</span></p>
                        </div>
                        <div class="desc_upgrades" id="desc_upgrd4">
                            <p>Fortalece a ressonância da linha de baixo, proporcionando um aumento constante nos
                                pontos.</p>
                            <p>+5 pontos por segundo.</p>
                        </div>
                    </div>

                    <div class="upgrades" id="botao_upgrd5" onclick="upgrd5()">
                        <!--Aumenta o valor por segundo com base na quantidade de upgrades - ex.: 20 upgrades dá ao jogador 0.20x a mais de pontos por segundo-->
                        <h2>Aliança com as lendas</h2>
                        <div class="custo_nivel">
                            <p>nvl. <span id="b_upgrd5">0</span></p>
                            <p>Custo: <span id="b_custoUpgrd5">5000</span></p>
                        </div>
                        <div class="desc_upgrades" id="desc_upgrd5">
                            <p>Junte-se a lendas do rock para um concerto épico, multiplicando todos os seus ganhos.</p>
                            <p>Multiplicador global para pontos e cliques.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>

<script>
    //quantidade de pontos o jogador tem e quantos pontos por segundo
    var pontos = 0;
    var porClique = 1

    //quantidade de vezes o jogador clicou e total de upgrades
    var cliques = 0;
    var totalCompras = 1;

    //níveis e custos de cada upgrade, do primeiro (1) ao quinto (5)
    var nvlUp1 = 1;
    var custoUp1 = 50;

    var nvlUp2 = 0;
    var custoUp2 = 15;

    var nvlUp3 = 0;
    var custoUp3 = 150;

    var nvlUp4 = 0;
    var custoUp4 = 450;

    var nvlUp5 = 0;
    var custoUp5 = 5000;

    //valor dos pontos atribuidos ao jogador por segundo.
    var porSegundo = 0;



    //Botão de clicar
    function clicker() {
        pontos += porClique;
        cliques += 1;
        b_pontos.innerHTML = pontos.toFixed(2);
    }

    //Upgrade 1: aumenta a quantidade de pontos recebidos por cada clique.
    function upgrd1() {
        if (pontos >= custoUp1) {
            pontos -= custoUp1;
            porClique += 1;
            totalCompras += 1;

            nvlUp1 += 1;
            custoUp1 *= 1.2;

            b_pontos.innerHTML = pontos.toFixed(2);
            b_upgrd1.innerHTML = nvlUp1;
            b_custoUpgrd1.innerHTML = custoUp1.toFixed(2);
        } else {
            alert(`Você precisa de mais ${(custoUp1 - pontos).toFixed(2)} para comprar esse upgrade.`);
        }
    }

    function upgrd2() {
        if (pontos >= custoUp2) {
            pontos -= custoUp2;
            porSegundo += 0.10;
            totalCompras += 1;

            nvlUp2 += 1;
            custoUp2 *= 1.1;

            b_pontos.innerHTML = pontos.toFixed(2);
            b_upgrd2.innerHTML = nvlUp2;
            b_custoUpgrd2.innerHTML = custoUp2.toFixed(2);
        } else {
            alert(`Você precisa de mais ${(custoUp2 - pontos).toFixed(2)} para comprar esse upgrade.`);
        }
    }

    function upgrd3() {
        if (pontos >= custoUp3) {
            pontos -= custoUp3;
            porSegundo += 2;
            totalCompras += 1;

            nvlUp3 += 1;
            custoUp3 *= 1.4;

            b_pontos.innerHTML = pontos.toFixed(2);
            b_upgrd3.innerHTML = nvlUp3;
            b_custoUpgrd3.innerHTML = custoUp3.toFixed(2);
        } else {
            alert(`Você precisa de mais ${(custoUp3 - pontos).toFixed(2)} para comprar esse upgrade.`);
        }
    }

    function upgrd4() {
        if (pontos >= custoUp4) {
            pontos -= custoUp4;
            porSegundo += 5;
            totalCompras += 1;

            nvlUp4 += 1;
            custoUp4 *= 1.8;

            b_pontos.innerHTML = pontos.toFixed(2);
            b_upgrd4.innerHTML = nvlUp4;
            b_custoUpgrd4.innerHTML = custoUp4.toFixed(2);
        } else {
            alert(`Você precisa de mais ${(custoUp4 - pontos).toFixed(2)} para comprar esse upgrade.`);
        }
    }

    function upgrd5() {
        if (pontos >= custoUp5) {
            pontos -= custoUp5;
            porSegundo += 1.2 * (nvlUp1 + nvlUp2 + nvlUp3 + nvlUp4 + nvlUp5);
            totalCompras += 1;

            nvlUp5 += 1;
            custoUp5 *= 1.9;

            b_pontos.innerHTML = pontos.toFixed(2);
            b_upgrd5.innerHTML = nvlUp5;
            b_custoUpgrd5.innerHTML = custoUp5.toFixed(2);
        } else {
            alert(`Você precisa de mais ${(custoUp5 - pontos).toFixed(2)} para comprar esse upgrade.`);
        }
    }

    var segundosTimer = 900;    //segundos para acabar o jogo
    var intervaloSegundos = setInterval(function () {   //setInterval para contar pontos por segundo e contar o timer do jogo
        pontos += porSegundo;
        segundosTimer--;

        b_pontos.innerHTML = pontos.toFixed(2);
        timerJogo.innerHTML = segundosTimer;
        if (segundosTimer == 0) {
            alert("O jogo acabou.");
            clearInterval(intervaloSegundos);   //zera o setInterval com o id dele.
            var botoesOnclicks = document.querySelectorAll("[onclick]");    //seleciona todos os elementos da página que possuem 'onclick'
            for (var contadorDeOnclicks = 0; contadorDeOnclicks < botoesOnclicks.length; contadorDeOnclicks++) {
                botoesOnclicks[contadorDeOnclicks].onclick = function (pararOnclick) {
                    pararOnclick.preventDefault();  //impede que o comportamento padrão do elemento 'onclick' seja executado
                }
            }

            console.log("Pontos adquiridos: ", pontos);
            console.log("Total de upgrades comprados: ", totalCompras);



        }
    }, 1000);


    cliques += onclick;

    function salvarSair() {

        if (pontos > 10) {
            fetch("/usuarios/clicker", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    pontosServer: pontos,
                    totalComprasServer: totalCompras,
                    idUsuarioServer: sessionStorage.idUsuario
                }),
            })
                .then(function (resposta) {
                    console.log("resposta: ", resposta);

                    if (resposta.ok) {
                        //mensagem de status de envio aqui!

                    } else {
                        console.log("Houve um erro na inserção de dados.");
                    }
                })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);
                });
        }
        // setTimeout(() => {
        //     window.location.href = "perfil.html";
        // }, 2000);
    }


    //descrição dos upgrades.
    botao_upgrd1.addEventListener("mouseover", function (event) {
        var x = event.clientX;
        var y = event.clientY;

        desc_upgrd1.style.width = '200px';
        desc_upgrd1.style.height = 'fit-content';
        desc_upgrd1.style.left = "-220px";
        desc_upgrd1.style.opacity = 0.5;
    });

    botao_upgrd1.addEventListener("mouseout", function () {
        desc_upgrd1.style.width = 0;
        desc_upgrd1.style.height = 0;
        desc_upgrd1.style.overflow = 'hidden';
        desc_upgrd1.style.left = 0 + "px";
        desc_upgrd1.style.opacity = 0;
        desc_upgrd1.style.opacity = 0;
    });


    botao_upgrd2.addEventListener("mouseover", function (event) {
        var x = event.clientX;
        var y = event.clientY;

        desc_upgrd2.style.width = '200px';
        desc_upgrd2.style.height = 'fit-content';
        desc_upgrd2.style.left = "-220px";
        desc_upgrd2.style.opacity = 0.5;
    });

    botao_upgrd2.addEventListener("mouseout", function () {
        desc_upgrd2.style.width = 0;
        desc_upgrd2.style.height = 0;
        desc_upgrd2.style.overflow = 'hidden';
        desc_upgrd2.style.left = 0 + "px";
        desc_upgrd2.style.opacity = 0;
        desc_upgrd2.style.opacity = 0;
    });


    botao_upgrd3.addEventListener("mouseover", function (event) {
        var x = event.clientX;
        var y = event.clientY;

        desc_upgrd3.style.width = '200px';
        desc_upgrd3.style.height = 'fit-content';
        desc_upgrd3.style.left = "-220px";
        desc_upgrd3.style.opacity = 0.5;
    });

    botao_upgrd3.addEventListener("mouseout", function () {
        desc_upgrd3.style.width = 0;
        desc_upgrd3.style.height = 0;
        desc_upgrd3.style.overflow = 'hidden';
        desc_upgrd3.style.left = 0 + "px";
        desc_upgrd3.style.opacity = 0;
        desc_upgrd3.style.opacity = 0;
    });


    botao_upgrd4.addEventListener("mouseover", function (event) {
        var x = event.clientX;
        var y = event.clientY;

        desc_upgrd4.style.width = '200px';
        desc_upgrd4.style.height = 'fit-content';
        desc_upgrd4.style.left = "-220px";
        desc_upgrd4.style.opacity = 0.5;
    });

    botao_upgrd4.addEventListener("mouseout", function () {
        desc_upgrd4.style.width = 0;
        desc_upgrd4.style.height = 0;
        desc_upgrd4.style.overflow = 'hidden';
        desc_upgrd4.style.left = 0 + "px";
        desc_upgrd4.style.opacity = 0;
        desc_upgrd4.style.opacity = 0;
    });


    botao_upgrd5.addEventListener("mouseover", function (event) {
        var x = event.clientX;
        var y = event.clientY;

        desc_upgrd5.style.width = '200px';
        desc_upgrd5.style.height = 'fit-content';
        desc_upgrd5.style.left = "-220px";
        desc_upgrd5.style.opacity = 0.5;
    });

    botao_upgrd5.addEventListener("mouseout", function () {
        desc_upgrd5.style.width = 0;
        desc_upgrd5.style.height = 0;
        desc_upgrd5.style.overflow = 'hidden';
        desc_upgrd5.style.left = 0 + "px";
        desc_upgrd5.style.opacity = 0;
        desc_upgrd5.style.opacity = 0;
    });
</script>